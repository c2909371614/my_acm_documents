define("acm/nowcoder/1.0.177/javascripts-acm/site/terminal/contest/index",["nc","cpn","ncpc","../../../component/contest/chat","../../../action/acm","../../../component/contest/notice","../../../component/popupSub/popupEvaluateProblem","../../../action/problem","../../../component/star"],function(t,i,e){var r,s,n=t("nc"),o=t("cpn"),d=t("ncpc"),m=n.$,v=(n.Db,n.Event),l=n.DragDrop,a=n.Sys,E=n.Base,c=n.Dom,u=n.Html,h=n.CodeLang,f=n.MathJax,p=o.Layer,g=(o.Popup,o.Tips),I=(d.Config,d.Code),w=d.Util,b=t("../../../component/contest/chat"),C=t("../../../component/contest/notice"),j=t("../../../component/popupSub/popupEvaluateProblem"),T=(t("../../../action/acm"),t("../../../action/problem"),"data-drag");a.ready({initialize:function H(){var i=this;w.getEditor(["codeEditor","codeFEEditor"],function(t){r=t.codeEditor,s=t.codeFEEditor,i.initData(),i.initAction(),i.initEditor(),i.initRightFold(),i.initResize(),i.initDragDrop(),i.initDragSplit(),i.initChat(),i.initNotice(),i.initFullQuestion(),i.initCopy(),g.title(".subject-item-title a"),f.image(m(".js-left"))})},initAction:function y(){I.onlineJudgeHelp({el:m(".js-coding-help")})},initData:function z(){var t=this;t.resultEl=m(".js-right-bottom"),E.copy(t,window,["pageInfo"]);var i=t.pageInfo||{};t.uuid=i.uuid||"",t.contestId=i.contestId,t.questionId=i.questionId,t.problemId=i.problemId,t.nextTqId=+i.nextTqId||0,t.nextTqUuid=i.nextTqUuid||"",t.tPage=+i.tPage||0,t.tpId=+i.tpId||0,t.topicTitle=i.topicTitle||""},initResize:function x(){var n=this,i=m(window),d=m("div.nk-main"),o=d.find("div.js-topic-menu").css("zIndex",999),r=o.find("div.terminal-topic-wrap"),s=o.find(".js-list"),a=d.find(".js-left"),e=d.find(".js-right"),c=e.children(),u=e.find("#jsCodeEditor"),l=a.find(".full-separator").css("zIndex",998);function t(){if(!n.codeEditor||!n.codeEditor.isFullScreen){d.outerHeight(i.height()).outerWidth(i.width()),a.addClass("code-body-hidden"),e.addClass("code-body-hidden");var t=d.height();h(t),function s(t){t=t||d.height(),a.outerHeight(t),t=a.height();var i=a.find("div.terminal-topic"),e=a.find(".terminal-topic-wrap"),n=e.outerHeight(),o=e.outerWidth()-a.find(".full-separator").outerWidth(),r=t-n;i.outerHeight(r).css("overflow-y","auto"),i.outerWidth(o),l.css("right",0).css("left","auto").height(i.height()).css("top",n),p(i)}(t),f(t)}}function h(t){var i=s.scrollTop();t=t||d.height(),o.outerHeight(t);var e=s.height("auto").outerHeight(),n=r.outerHeight();s.outerHeight(e+t-n),s.scrollTop(i)}function f(t){t=t||d.height(),e.outerHeight(t),t=e.height();var i=0;E.forEach(c,function(t){"none"!==(t=m(t)).css("display")&&t.get(0)!==u.get(0)&&(i+=t.outerHeight())}),u.outerHeight(Math.max(100,t-i)),n.codeEditor&&n.codeEditor.resize(null,u.height()),n.resultEl.outerWidth(e.width()).outerHeight(Math.max(60,.2*t)),m("#jsRunInfo").outerHeight(n.resultEl.height())}function p(t){if(n.pageInfo.isPdfContent){var i=t.find(".js-frame-box"),e=t.height()-g(t.find(".subject-question"))-g(t.find(".subject-item-title"))-g(i,!0);i.outerHeight(e).outerWidth(t.width())}}function g(t,i){return(i?0:t.outerHeight())+parseFloat(t.css("margin-top"),10)+parseFloat(t.css("margin-bottom"),10)}m(document.body).addClass("code-body-hidden"),i.on("resize",function(){window.setTimeout(t,50)}),v.listen("resizeAll",t),v.listen("resizeMenu",h),v.listen("resizeRight",f),v.listen("resizePdf",p),t()},initEditor:function F(){var i,n=this,t=n.pageInfo;if(n.isFront())var e=I.initFECodeEditor(s,{noAutoSize:!0,questionId:t.questionId,supportLang:t.supportLang,langTpl:h.getTplFE(),codeEl:m("#jsCodeEditor"),runInfoEl:m("#jsRunInfo"),runCodeEl:m("#jsRunCode"),loadCodeEl:m("#jsLoadCode"),loadAcceptCodeEl:m("#jsLoadAcceptCode"),autoFixHeight:!0});else var e=I.initCodeEditor(r,{noAutoSize:!0,autoFixHeight:!0,selfTestType:t.selfType,selfTestSystemCase:h.getExample(),questionId:t.questionId,tagId:t.tagId,subTagId:t.subTagId,codeJudgeType:t.codeJudgeType,runExtParam:{tagId:t.tagId,doneQuestionId:t.doneQuestionId},langTpl:h.getTpl(),codeEl:m("#jsCodeEditor"),runInfoEl:m("#jsRunInfo"),runCodeEl:m("#jsRunCode"),loadCodeEl:m("#jsLoadCode"),loadAcceptCodeEl:m("#jsLoadAcceptCode")});function o(t){window.clearInterval(i);var e=m("#jsRunDuration").hide().html("");if(!1!==t){var n=0;i=window.setInterval(function(){var t=n,i="运行中("+ ++n+"s)"+new Array(t%3+2).join(".");e.html(i).show()},1e3)}}e.listen("beforeRunCode",function(){n.openTab(),o()}),e.listen("runCodeError",function(){o(!1)}),e.listen("runCodeFinish",function(){o(!1)}),e.listen("runCodeSuccess",function(e){j.ifShow({problemId:n.problemId,batch:!1,submissionId:e.submissionId,call:function(t,i){t&&j.show({problemId:n.problemId,batch:!1,submissionId:e.submissionId,tagRate:i})}})}),e.listen("fullScreen",function(t){!t&&v.fire("resizeAll")}),e.showResult=function(t,i,e,n){var o=this.rawConfig,r=o.tipEl;if(107===n.status)return r.css("color","#00bc9b").html("<div>代码已提交，可在比赛结束后查看比赛成绩（可在提交列表页面提前查看代码是否有编译错误）</div>");if(!(t=m.trim(t)))return r.html("").hide();r.css("color",!0===i?"#b6b79a":"#00bc9b");var s=e?"<div>自测结果</div>":"";s+=!1===i?'<div class="ico-passed">通过</div>':!0===i?'<div class="ico-unpass">不通过</div>':"",s+="<div>"+t.replace(/\n/g,"<br />")+"</div>",r.html(s)},n.codeEditor=e},initRightFold:function S(){var n=this;m(document).on("click",".js-fold",function(t){var i=m(t.currentTarget),e=i.find("a");n.openTab(e.hasClass("icon-angle-up"))})},initDragDrop:function R(){var s=this,t=m(".js-fold"),d=s.resultEl,a=m(".js-right"),c=a.find("#jsCodeEditor"),u=a.children(),i=t.find("a");function e(){return!(i.hasClass("icon-angle-up")||s.codeEditor&&s.codeEditor.isFullScreen)}new l({drag:t,listeners:[{name:"start",handler:function(){e()&&(this._bottomHeight=d.outerHeight(),t.attr(T,"1"))}},{name:"drag",handler:function(){if(e()){var t=this._downY-this._moveY;!function r(t,i){var e=a.height(),t=Math.max(60,t+i),n=0;E.forEach(u,function(t){(t=m(t)).get(0)!==c.get(0)&&t.get(0)!==d.get(0)&&(n+=t.outerHeight())});var o=e-n-t;o<100&&(t=e-n-(o=100));c.outerHeight(o),s.codeEditor&&s.codeEditor.resize(null,c.height()),d.outerHeight(t),m("#jsRunInfo").outerHeight(s.resultEl.height())}(this._bottomHeight,t)}}},{name:"drop",handler:function(){e()&&(this._bottomHeight=null,window.setTimeout(function(){t.removeAttr(T)},0))}}]})},initDragSplit:function A(){var i,e,t=m(".full-separator"),n=m("div.nk-main"),o=n.find(".js-left"),r=n.find(".js-right"),s=m(".js-frame-box div");new l({drag:t,listeners:[{name:"start",handler:function(){this.offset=t.offset(),i=o.width(),e=r.width(),s.show()}},{name:"drag",handler:function(){var t=this._moveX-this._downX;o.width()<=250&&t<0||r.width()<=550&&0<t||(o.width(i+t),r.width(e-t),r.css("marginLeft",i+t),v.fire("resizeAll"))}},{name:"drop",handler:function(){this.offset=null,s.hide();var t=s.parent().find("iframe");t.attr("src",t.attr("src"))}}]})},initChat:function q(){var t=this,i=t.pageInfo;if(i.isFinished||!i.isSignUp)return;t.chat=new b({manager:t,contestId:t.contestId,questionId:t.problemId,signUpId:i.signUpId})},initNotice:function D(){var t=m(".nk-acm-container"),i=this.noticeCpn=new C({renderTo:t.find("div.nk-main"),renderBy:"before",resize:function(){v.fire("resizeAll")}});i.getEl().css("top","0px"),v.listen("MSG_EVENT_NOTICE_SHOW",function(){i.showNotice.apply(i,arguments)}),v.listen("MSG_EVENT_NOTICE_HIDE",function(){i.closeNotice.apply(i,arguments)})},initFullQuestion:function _(){var t,i=m(window),e=m(".js-full-question").show(),n=m(".js-small-question").hide(),o=m(".terminal-topic"),r=m(".js-topic-title");function s(){if(e[t?"show":"hide"](),n[t?"hide":"show"](),t)return r.after(o),t.destroy(),t=null,void v.fire("resizeAll");t=new p({showContent:!0,clickToHide:!1,listeners:{render:function(){this.contentEl.css("background-color","#fff"),this.append(o),o.outerWidth(i.width()).outerHeight(i.height()),v.fire("resizePdf",o)},winresize:function(){o.outerWidth(i.width()).outerHeight(i.height()),v.fire("resizePdf",o)}}})}e.on("click",s),n.on("click",s)},initCopy:function k(){u.copy({el:m(".js-left"),max:50,dealContent:function(t,i,e){var n=[],o=window.location.href;return n.push("链接："+(e?'<a target="_blank" href="'+o+'">'+o+"</a>":o)),n.push("来源：牛客网"),n.push(""),n.push(i),n.join(e?"<br />":"\n")}})},openTab:function P(t){var i=m(".js-fold");t=!1!==t,"1"!==i.attr(T)&&(c.cls(i.find("a"),{"icon-angle-down":t,"icon-angle-up":!t}),this.resultEl[t?"show":"hide"](),i.css("cursor",t?"ns-resize":"pointer"),v.fire("resizeRight"))},isFront:function L(){return"2"===E.id(this.pageInfo.codeJudgeType)}})});